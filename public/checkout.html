<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Check out</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <div class="afc__payment-form">
    <form id="payment-form">
      <div class="full-name">
        <div class="afc__form-field">
          <label>First name</label>
          <input type="text" name="first-name">
        </div>
        <div class="afc__form-field">
          <label>Last name</label>
          <input type="text" name="last-name">
        </div>
      </div>
      <div class="afc__form-field">
        <label>Email</label>
        <input type="email" name="email">
      </div>
      <div class="afc__form-field">
        <label>Phone</label>
        <input type="tel" name="phone">
      </div>
      <div class="afc__form-field">
        <label>Delivery address</label>
        <textarea name="address"></textarea>
      </div>
      <div class="afc__form-field">
        <label>City</label>
        <input type="text" name="city">
      </div>
      <div class="afc__form-field">
        <label>State</label>
        <input type="text" name="state">
      </div>
      <div class="afc__form-field">
        <label>Zip code</label>
        <input type="text" name="zip">
      </div>
      <div class="afc__form-field">
        <label>Payment</label>
        <div id="card-element">
          <!-- Elements will create input elements here -->
        </div>
        <!-- We'll put the error messages in this element -->
        <div id="card-errors" role="alert"></div>
      </div>

      <button id="submit" class="afc__button">Pay</button>
    </form>
  </div>

  <script>
    const stripe = Stripe('pk_test_fVKvhV5JXchL685gt2bl4hcX00eBMJvczm');
    const elements = stripe.elements();

    const form = document.getElementById('payment-form');
    const inputs = form.elements;

    const style = {
      base: {
        color: "#32325d",
      }
    };

    const cardElement = elements.create("card", { style: style });
    cardElement.mount("#card-element");

    form.addEventListener('submit', function (ev) {
      ev.preventDefault();
      const customer = {
        firstName: inputs["first-name"].value,
        lastName: inputs["last-name"].value,
        email: inputs["email"].value,
        phone: inputs["phone"].value,
        deliveryAddress: inputs["address"].value,
        city: inputs["city"].value,
        state: inputs["state"].value,
        zip: inputs["zip"].value
      }
      stripe.createPaymentMethod({
        type: 'card',
        card: cardElement,
        billing_details: {
          address: {
            city: customer.city,
            line1: customer.deliveryAddress,
            line2: null,
            postal_code: customer.zip,
            state: customer.state
          },
          email: customer.email,
          name: customer.firstName + ' ' + customer.lastName,
          phone: customer.phone
        }
      }).then(stripePaymentMethodHandler);
    });

    function stripePaymentMethodHandler(result) {
      if (result.error) {
        // Show error in payment form
      } else {
        // Otherwise send paymentMethod.id to your server
        fetch('/create-customer', {
          method: 'post',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            customer_details: result.paymentMethod.billing_details,
            payment_method: result.paymentMethod.id
          }),
        }).then(function (result) {
          return result.json();
        }).then(function () {
          console.log('success');
        });
      }
    }
  </script>
</body>

</html>